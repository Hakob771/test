on:
  workflow_dispatch:
  push:
  
jobs:
  job1:
    runs-on:
      - ubuntu-latest
      
    outputs:
      environments: "${{ steps.get-env-names.outputs.envs }}"
      
    steps:
      - name: 'Get environments'
        id: get-env-names
        run: |
          keys=$(echo -e '${{ vars.ENVS }}' | jq 'keys | map(. + "")')
          echo """envs="$keys"""" >> $GITHUB_OUTPUT
          
  job2:
    needs:
      - job1
      
    runs-on:
      - ubuntu-latest
      
    strategy:
      matrix:
        environments: ${{ fromJSON(needs.job1.outputs.environments) }}
        
    steps:
      - name: print2
        run: |
          echo ${{ matrix.environments }}
  
  job3: 
    needs:
      - job2
      
    runs-on:
      - ubuntu-latest
      
    steps:
      - name: print3
        run: |
          echo ${{ needs.job2.matrix.environments }} 2>/dev/null || true
